import{_ as Y}from"./Cn46K1Mv.js";import{r as c,g as G,j as J,c as o,k as l,a as t,p as P,q as f,v as g,t as d,n as K,F as b,x as h,m as w,y as X,d as _,b as B,w as j,z as Z,A as ee,o as a,B as z,C as E}from"./CuVkK9Pu.js";import{u as te}from"./BTe73nwi.js";const se={class:"max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8"},oe={key:0},ae={class:"md:grid md:grid-cols-3 md:gap-6"},ne={class:"mt-5 md:mt-0 md:col-span-2"},le={class:"shadow sm:rounded-md sm:overflow-hidden"},ie={class:"px-4 py-5 bg-white space-y-6 sm:p-6"},de={class:"grid grid-cols-6 gap-6"},re={class:"col-span-6 sm:col-span-3"},ue={class:"col-span-6 sm:col-span-3"},ce={class:"col-span-6"},me={class:"col-span-6"},pe={class:"md:grid md:grid-cols-3 md:gap-6 mt-10"},fe={class:"mt-5 md:mt-0 md:col-span-2"},ge={class:"bg-white shadow sm:rounded-lg p-6"},xe={class:"flex items-center justify-between mb-6"},ye={key:0,class:"space-y-6"},ve={class:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center"},be={key:0,class:"space-y-1"},he={key:1,class:"text-indigo-600"},we={class:"space-y-4"},_e=["onClick"],ke={class:"grid grid-cols-2 gap-4"},$e=["onUpdate:modelValue"],Ae=["onUpdate:modelValue"],Ce={key:1,class:"mt-8"},Ue={class:"space-y-4"},Te={class:"font-bold text-indigo-700"},De={class:"mt-2 text-sm"},Ie={key:0},Ve={class:"font-medium"},Se={key:0,class:"ml-1"},Fe={key:1,class:"ml-1"},Pe={key:1,class:"mt-2 pt-2 border-t"},Be={key:2,class:"mt-8"},je={class:"divide-y divide-gray-200"},ze={class:"font-medium"},Ee={class:"text-sm text-gray-500 ml-2"},He=["onClick"],Le={class:"fixed bottom-4 right-4 w-80 md:w-96"},Me={key:0,class:"bg-white rounded-lg shadow-xl border flex flex-col h-96"},Ne={class:"p-4 bg-indigo-600 text-white rounded-t-lg flex justify-between items-center"},Re={class:"p-3 border-t"},Oe={key:1,class:"text-center py-20"},qe={class:"mt-4"},Je={__name:"dashboard",setup(We){const{user:U,token:x,isLoggedIn:$,updateProfile:H,deleteAccount:L}=te(),y=ee(),m=c({first_name:U.value?.first_name||"",last_name:U.value?.last_name||"",email:U.value?.email||"",password:""}),M=async()=>{const n=await H(m.value);n.success?alert("Profile updated!"):alert(n.message)},N=async()=>{if(confirm("Are you sure you want to delete your account? This action is permanent.")){const n=await L();n.success?(alert("Account deleted."),Z("/")):alert(n.message)}},k=c(!1),T=c(!1),D=c([]),A=c([{label:"",amount:0}]),I=c([]),S=async()=>{if($.value)try{const n=await $fetch(`${y.public.apiBase}/tax/documents`,{headers:{Authorization:x.value}});n.status==="success"&&(D.value=n.data.documents)}catch{}},F=async()=>{if($.value)try{const n=await $fetch(`${y.public.apiBase}/tax/data`,{headers:{Authorization:x.value}});n.status==="success"&&(I.value=n.data.tax_data)}catch{}},R=async n=>{const e=n.target.files[0];if(!e)return;T.value=!0;const r=new FormData;r.append("file",e),r.append("year","2024"),r.append("document_type",e.name.includes("1099")?"1099":"W2");try{const s=await $fetch(`${y.public.apiBase}/tax/upload`,{method:"POST",headers:{Authorization:x.value},body:r});s.status==="success"&&(alert("Document uploaded and data extracted!"),console.log("Extracted Data:",s.data.extracted_data),S(),F())}catch{alert("Upload failed")}finally{T.value=!1,k.value=!1}},O=async()=>{try{(await $fetch(`${y.public.apiBase}/tax/data`,{method:"POST",headers:{Authorization:x.value},body:{year:2024,data:{manual:A.value}}})).status==="success"&&alert("Manual data saved!")}catch{alert("Save failed")}},q=async n=>{const e=`${y.public.apiBase}/tax/download/${n.id}`,r=document.createElement("a");r.href=e;try{const i=await(await fetch(e,{headers:{Authorization:x.value}})).blob(),u=window.URL.createObjectURL(i);r.href=u,r.download=n.file_name,r.click()}catch{alert("Download failed")}},V=c(!1),v=c(""),C=c([{role:"assistant",content:"Hello! I am your tax helper. I have access to your tax records. How can I help you today?"}]),p=c(null),W=async()=>{if(!v.value.trim())return;const n=v.value;C.value.push({role:"user",content:n}),v.value="",E(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)});try{const e=await $fetch(`${y.public.apiBase}/tax/ai-helper`,{method:"POST",headers:{Authorization:x.value},body:{question:n}});e.status==="success"&&C.value.push({role:"assistant",content:e.data.answer})}catch{C.value.push({role:"assistant",content:"Sorry, I am having trouble connecting right now."})}E(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})},Q=G();return J(()=>{$.value?(S(),F()):Q.push("/login")}),(n,e)=>{const r=Y;return a(),o("div",se,[l($)?(a(),o("div",oe,[t("div",ae,[e[15]||(e[15]=t("div",{class:"md:col-span-1"},[t("div",{class:"px-4 sm:px-0"},[t("h3",{class:"text-lg font-medium leading-6 text-gray-900"},"Profile"),t("p",{class:"mt-1 text-sm text-gray-600"},"Update your account information.")])],-1)),t("div",ne,[t("form",{onSubmit:P(M,["prevent"])},[t("div",le,[t("div",ie,[t("div",de,[t("div",re,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700"},"First name",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l(m).first_name=s),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[g,l(m).first_name]])]),t("div",ue,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"Last name",-1)),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l(m).last_name=s),type:"text",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[g,l(m).last_name]])]),t("div",ce,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"Email address",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l(m).email=s),type:"email",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[g,l(m).email]])]),t("div",me,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"New Password (optional)",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l(m).password=s),type:"password",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,512),[[g,l(m).password]])])])]),t("div",{class:"px-4 py-3 bg-gray-50 text-right sm:px-6 flex justify-between"},[t("button",{onClick:N,type:"button",class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Delete Account "),e[14]||(e[14]=t("button",{type:"submit",class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," Save ",-1))])])],32)])]),e[26]||(e[26]=t("div",{class:"hidden sm:block","aria-hidden":"true"},[t("div",{class:"py-5"},[t("div",{class:"border-t border-gray-200"})])],-1)),t("div",pe,[e[22]||(e[22]=t("div",{class:"md:col-span-1"},[t("div",{class:"px-4 sm:px-0"},[t("h3",{class:"text-lg font-medium leading-6 text-gray-900"},"Tax Filing"),t("p",{class:"mt-1 text-sm text-gray-600"},"File your taxes for the current year or view history.")])],-1)),t("div",fe,[t("div",ge,[t("div",xe,[e[16]||(e[16]=t("h4",{class:"text-lg font-medium"},"File Tax for 2024",-1)),t("button",{onClick:e[4]||(e[4]=s=>k.value=!l(k)),class:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700"},d(l(k)?"Cancel":"Start Filing"),1)]),l(k)?(a(),o("div",ye,[t("div",ve,[t("input",{type:"file",ref:"fileInput",onChange:R,class:"hidden"},null,544),l(T)?(a(),o("div",he,"Uploading and extracting data...")):(a(),o("div",be,[e[17]||(e[17]=t("p",{class:"text-gray-600"},"Upload W2 or 1099",-1)),t("button",{onClick:e[5]||(e[5]=s=>n.$refs.fileInput.click()),class:"text-indigo-600 font-medium hover:text-indigo-500"}," Click to select a file ")]))]),e[18]||(e[18]=K('<div class="relative"><div class="absolute inset-0 flex items-center" aria-hidden="true"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">Or enter manually</span></div></div>',1)),t("div",we,[(a(!0),o(b,null,h(l(A),(s,i)=>(a(),o("div",{key:i,class:"p-4 border rounded-md relative"},[t("button",{onClick:u=>l(A).splice(i,1),class:"absolute top-2 right-2 text-red-500"},"Ã—",8,_e),t("div",ke,[f(t("input",{"onUpdate:modelValue":u=>s.label=u,placeholder:"Description (e.g. Interest)",class:"border rounded px-2 py-1"},null,8,$e),[[g,s.label]]),f(t("input",{"onUpdate:modelValue":u=>s.amount=u,type:"number",placeholder:"Amount",class:"border rounded px-2 py-1"},null,8,Ae),[[g,s.amount]])])]))),128)),t("button",{onClick:e[6]||(e[6]=s=>l(A).push({label:"",amount:0})),class:"text-sm text-indigo-600 font-medium"},"+ Add item"),t("div",{class:"text-right"},[t("button",{onClick:O,class:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700"},"Save Manual Info")])])])):w("",!0),l(I).length>0?(a(),o("div",Ce,[e[20]||(e[20]=t("h5",{class:"font-medium mb-3"},"Extracted Tax Summary",-1)),t("div",Ue,[(a(!0),o(b,null,h(l(I),s=>(a(),o("div",{key:s.id,class:"border rounded-md p-4 bg-gray-50"},[t("h6",Te,"Year: "+d(s.year),1),t("div",De,[s.data.documents&&s.data.documents.length>0?(a(),o("div",Ie,[(a(!0),o(b,null,h(s.data.documents,(i,u)=>(a(),o("div",{key:u,class:"mt-1 pb-1 border-b last:border-0"},[t("span",Ve,d(i.type)+":",1),i.extracted.employer?(a(),o("span",Se,"Employer: "+d(i.extracted.employer)+", Wages: $"+d(i.extracted.wages),1)):i.extracted.payer?(a(),o("span",Fe,"Payer: "+d(i.extracted.payer)+", Income: $"+d(i.extracted.interest_income),1)):w("",!0)]))),128))])):w("",!0),s.data.manual&&s.data.manual.length>0?(a(),o("div",Pe,[e[19]||(e[19]=t("p",{class:"italic text-gray-500"},"Manual Entries:",-1)),(a(!0),o(b,null,h(s.data.manual,(i,u)=>(a(),o("div",{key:u,class:"ml-2"}," - "+d(i.label)+": $"+d(i.amount),1))),128))])):w("",!0)])]))),128))])])):w("",!0),l(D).length>0?(a(),o("div",Be,[e[21]||(e[21]=t("h5",{class:"font-medium mb-3"},"Previous Uploads",-1)),t("ul",je,[(a(!0),o(b,null,h(l(D),s=>(a(),o("li",{key:s.id,class:"py-3 flex justify-between items-center"},[t("div",null,[t("span",ze,d(s.year)+" "+d(s.document_type),1),t("span",Ee,d(s.file_name),1)]),t("button",{onClick:i=>q(s),class:"text-indigo-600 hover:text-indigo-900 text-sm font-medium"},"Download",8,He)]))),128))])])):w("",!0)])])]),t("div",Le,[l(V)?(a(),o("div",Me,[t("div",Ne,[e[23]||(e[23]=t("span",{class:"font-medium"},"Tax AI Helper",-1)),t("button",{onClick:e[7]||(e[7]=s=>V.value=!1),class:"text-white hover:text-gray-200"},"Ã—")]),t("div",{class:"flex-1 p-4 overflow-y-auto space-y-4",ref_key:"chatContainer",ref:p},[(a(!0),o(b,null,h(l(C),(s,i)=>(a(),o("div",{key:i,class:z(s.role==="user"?"text-right":"text-left")},[t("span",{class:z([s.role==="user"?"bg-indigo-100":"bg-gray-100","inline-block px-3 py-2 rounded-lg text-sm max-w-[80%]"])},d(s.content),3)],2))),128))],512),t("div",Re,[t("form",{onSubmit:P(W,["prevent"]),class:"flex gap-2"},[f(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>X(v)?v.value=s:null),placeholder:"Ask a tax question...",class:"flex-1 border rounded-md px-3 py-1 text-sm"},null,512),[[g,l(v)]]),e[24]||(e[24]=t("button",{type:"submit",class:"bg-indigo-600 text-white px-3 py-1 rounded-md text-sm"},"Ask",-1))],32)])])):(a(),o("button",{key:1,onClick:e[9]||(e[9]=s=>V.value=!0),class:"bg-indigo-600 text-white p-4 rounded-full shadow-lg hover:bg-indigo-700"},[...e[25]||(e[25]=[t("span",{class:"sr-only"},"AI Helper",-1),_(" ðŸ¤– ",-1)])]))])])):(a(),o("div",Oe,[e[32]||(e[32]=t("h2",{class:"text-2xl font-bold"},"Welcome to Tax File App",-1)),t("p",qe,[e[29]||(e[29]=_("Please ",-1)),B(r,{to:"/login",class:"text-indigo-600"},{default:j(()=>[...e[27]||(e[27]=[_("Login",-1)])]),_:1}),e[30]||(e[30]=_(" or ",-1)),B(r,{to:"/register",class:"text-indigo-600"},{default:j(()=>[...e[28]||(e[28]=[_("Register",-1)])]),_:1}),e[31]||(e[31]=_(" to continue.",-1))])]))])}}};export{Je as default};
